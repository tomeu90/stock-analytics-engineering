version: 2

models:
  - name: fct_asset_fundamentals
    description: >
      Fact table containing core company fundamental, profitability, liquidity,
      leverage, margin, earnings, revenue, and growth metrics, along with
      descriptive classifications and audit metadata.

    config:

      freshness:
        warn_after:
          count: 24
          period: hour
      tags: [asset, fact, fundamentals]

    tests:
      - grain_unique:
          columns: ['sk_asset_ticker', 'audit_loaded_at']

    columns:
      - name: sk_asset_ticker
        data_type: string
        description: "{{ doc('column_sk_asset_ticker') }}"
        tests:
          - not_null

      - name: pct_return_on_assets
        data_type: double
        description: "Return on assets (ROA), measuring profitability relative to total assets, expressed as a rate. An indicator of how profitable a company is relative to its total assets. ROA gives an idea as to how efficient management is at using its assets to generate earnings. Calculated by dividing a company's annual earnings by its total assets, ROA is displayed as a percentage."

      - name: desc_return_on_assets
        data_type: string
        description: >
          Categorized assessment of return on assets (ROA). Values represent:
          Unprofitable (ROA < 0), Low Return on Assets (0%-5%), Healthy Return on Assets
          (5%-10%), Strong Return on Assets (10%-20%), and Exceptional Return on Assets
          (>20%).

      - name: pct_return_on_equity
        data_type: double
        description: "Return on equity (ROE), measuring profitability relative to shareholders' equity, expressed as a rate. A measure of a corporation's profitability that reveals how much profit a company generates with the money shareholders have invested. Calculated as Net Income / Shareholder's Equity."

      - name: desc_return_on_equity
        data_type: string
        description: >
          Categorized assessment of return on equity (ROE). Values represent:
          Negative Return on Equity (ROE < 0), Low Return on Equity (0%-10%),
          Healthy Return on Equity (10%-20%), Strong Return on Equity (20%-35%),
          and Very High Return on Equity (>35%).

      - name: pct_return_on_invested_capital
        data_type: double
        description: "Return on invested capital (ROIC), measuring efficiency of capital allocation, expressed as a rate. A financial metric used to measure a company's efficiency in allocating its capital to generate returns. It assesses how well a company is using its resources to create value for its investors. ROIC is particularly useful for evaluating a company's profitability and its ability to sustain competitive advantages over time. ROIC is calculated as Net Income / Invested Capital."

      - name: desc_return_on_invested_capital
        data_type: string
        description: >
          Categorized assessment of return on invested capital (ROIC). Values represent:
          Weak Return on Invested Capital (<5%), Adequate Return on Invested Capital
          (5%-10%), Strong Return on Invested Capital (10%-20%), and Excellent Return
          on Invested Capital (>20%).

      - name: rt_current_ratio
        data_type: double
        description: "A liquidity ratio that measures a company's ability to pay short-term obligations. Calculated as Current Assets / Current Liabilities."

      - name: desc_current_ratio
        data_type: string
        description: >
          Categorized liquidity assessment based on the current ratio. Values represent:
          Liquidity Risk (<1.0), Thin Liquidity (1.0-1.5), Healthy Liquidity (1.5-3.0),
          and Excess Liquidity (>3.0).

      - name: rt_quick_ratio
        data_type: double
        description: "An indicator of a company's short-term liquidity. The quick ratio measures a company's ability to meet its short-term obligations with its most liquid assets. The higher the quick ratio, the better the position of the company. Calculated as (Current Assets - Inventories) / Current Liabilities."

      - name: desc_quick_ratio
        data_type: string
        description: >
          Categorized assessment of short-term liquidity using the quick ratio.
          Values represent: Liquidity Stress (<0.8), Adequate Liquidity (0.8-1.2),
          Strong Liquidity (1.2-2.0), and Very Strong Liquidity (>2.0).

      - name: rt_long_term_debt_equity_ratio
        data_type: double
        description: "Long-term debt-to-equity ratio, measuring long-term financial leverage. It's calculated by dividing its long term debt by stockholders' equity. It indicates what proportion of equity and long-term debt the company is using to finance its assets."

      - name: rt_total_debt_equity_ratio
        data_type: double
        description: "Total debt-to-equity ratio, measuring overall financial leverage including short- and long-term debt. A measure of a company's financial leverage calculated by dividing its liabilities by stockholders' equity. It indicates what proportion of equity and debt the company is using to finance its assets."

      - name: desc_total_debt_equity_ratio
        data_type: string
        description: >
          Categorized leverage assessment based on total debt to equity.
          Values represent: Low Leverage (<0.3), Moderate Leverage (0.3-1.0),
          High Leverage (1.0-2.0), and Very High Leverage (>2.0).

      - name: pct_gross_margin
        data_type: double
        description: "A company's total sales revenue minus its cost of goods sold, divided by the total sales revenue, expressed as a rate. The gross margin represents the percent of total sales revenue that the company retains after incurring the direct costs associated with producing the goods and services sold by a company. The higher the percentage, the more the company retains on each dollar of sales to service its other costs and obligations."

      - name: desc_gross_margin
        data_type: string
        description: >
          Categorized assessment of gross margin profitability. Values represent:
          Low Margin (<20%), Average Margin (20%-40%), High Margin (40%-60%),
          and Exceptional Margin (>60%).

      - name: pct_operating_margin
        data_type: double
        description: "Operating margin is a measurement of what proportion of a company's revenue is left over after paying for variable costs of production such as wages, raw materials, etc. A healthy operating margin is required for a company to be able to pay for its fixed costs, such as interest on debt. Calculated as Operating Income / Net Sales, expressed as a rate."

      - name: desc_operating_margin
        data_type: string
        description: >
          Categorized assessment of operating margin. Values represent:
          Operating Loss (<0%), Thin Margin (0%-10%), Healthy Margin (10%-25%),
          and Strong Margin (>25%).

      - name: pct_profit_margin
        data_type: double
        description: "A ratio of profitability calculated as net income divided by revenues, or net profits divided by sales. It measures how much out of every dollar of sales a company actually keeps in earnings, expressed as a rate."

      - name: desc_profit_margin
        data_type: string
        description: >
          Categorized assessment of net profitability. Values represent:
          Unprofitable (<0%), Low Profitability (0%-10%), Strong Profitability
          (10%-25%), and Very Profitable (>25%).

      - name: mnt_cash_per_share
        data_type: double
        description: "Cash and cash equivalents per share."

      - name: qty_employees
        data_type: double
        description: "Total number of employees reported by the company."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: ">= 0"

      - name: mnt_company_income
        data_type: bigint
        description: "Net income reported by the company."

      - name: mnt_company_sales
        data_type: bigint
        description: "Total sales reported by the company."

      - name: rt_earnings_per_share_trail_twelve_months
        data_type: double
        description: "Earnings per share (EPS) over the trailing twelve months (TTM)."

      - name: rt_earnings_per_share_next_quarter
        data_type: double
        description: "Estimated earnings per share (EPS) for the next fiscal quarter."

      - name: dt_earnings_release_date
        data_type: timestamp
        description: "Next scheduled earnings announcement date at the time of data extraction."

      - name: pct_earnings_per_share_surprise
        data_type: double
        description: "Percentage difference between reported earnings per share (EPS) and analyst expectations."

      - name: desc_earnings_per_share_surprise
        data_type: string
        description: >
          Categorized assessment of earnings surprise. Values represent:
          Large Miss (< -10%), Miss (-10% to 0%), Inline (0%-10%), and Beat (>10%).

      - name: pct_revenue_surprise
        data_type: double
        description: "Percentage difference between reported revenue and analyst expectations."

      - name: desc_revenue_surprise
        data_type: string
        description: >
          Categorized assessment of revenue surprise. Values represent:
          Revenue Miss (< -5%), Slight Miss (-5% to 0%), Inline (0%-5%), and
          Revenue Beat (>5%).

      - name: dt_initial_public_offer_date
        data_type: timestamp
        description: "Date when the company first became publicly traded through an initial public offering (IPO)."

      - name: desc_company_maturity
        data_type: string
        description: >
          Classification of company maturity based on years since IPO.
          Values represent: Recent IPO (<3 years), Mid-Life Company (3-10 years),
          and Mature Company (>10 years).

      - name: pct_earnings_per_share_growth_past_5_years
        data_type: double
        description: "Historical average annual EPS growth rate over the past five years, expressed as a rate."

      - name: pct_earnings_per_share_growth_past_3_years
        data_type: double
        description: "Historical average annual EPS growth rate over the past three years, expressed as a rate."

      - name: pct_earnings_per_share_growth_quarter_over_quarter
        data_type: double
        description: "Quarter-over-quarter EPS growth for the most recent period, expressed as a rate."

      - name: pct_earnings_per_share_year_over_year_trail_twelve_months
        data_type: double
        description: "Year-over-year EPS growth over the trailing twelve months (TTM), expressed as a percentage."

      - name: pct_earnings_per_share_growth_this_year
        data_type: double
        description: "The portion of a company's profit allocated to each outstanding share of common stock. Expected or reported EPS growth rate for the current fiscal year, expressed as a rate."
        
      - name: pct_earnings_per_share_growth_next_year
        data_type: double
        description: "The portion of a company's profit allocated to each outstanding share of common stock. Expected EPS growth rate for the next fiscal year, expressed as a rate."

      - name: pct_earnings_per_share_growth_next_5_years
        data_type: double
        description: "Projected average annual EPS growth rate over the next five years, expressed as a rate."

      - name: pct_sales_growth_past_5_years
        data_type: double
        description: "Historical average annual sales growth rate over the past five years, expressed as a rate."

      - name: pct_sales_growth_past_3_years
        data_type: double
        description: "Historical average annual sales growth rate over the past three years, expressed as a rate."

      - name: pct_sales_growth_quarter_over_quarter
        data_type: double
        description: "Quarter-over-quarter sales growth for the most recent period, expressed as a rate."
        
      - name: pct_sales_year_over_year_trail_twelve_months
        data_type: double
        description: "Year-over-year sales growth over the trailing twelve months (TTM), expressed as a percentage."

      - name: audit_loaded_at
        data_type: int
        description: "{{ doc('column_audit_loaded_at') }}"
        tests:
          - not_null

      - name: audit_created_at
        data_type: timestamp
        description: "{{ doc('column_audit_created_at') }}"
        tests:
          - not_null